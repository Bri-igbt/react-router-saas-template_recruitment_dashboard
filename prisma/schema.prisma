generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model UserAccount {
  id             String                   @id @default(cuid(2))
  supabaseUserId String                   @unique
  createdAt      DateTime                 @default(now())
  updatedAt      DateTime                 @updatedAt
  email          String                   @unique
  name           String                   @default("")
  memberships    OrganizationMembership[]
}

model Organization {
  id          String                   @id() @default(cuid(2))
  createdAt   DateTime                 @default(now())
  updatedAt   DateTime                 @updatedAt
  name        String
  /// We avoid conflicts from slugs by using Prisma middleware. See the file
  /// `app/utils/database.server.ts`.
  slug        String                   @unique
  imageUrl    String                   @default("")
  memberships OrganizationMembership[]
}

enum OrganizationMembershipRole {
  owner
  admin
  member
}

model OrganizationMembership {
  createdAt      DateTime                   @default(now())
  updatedAt      DateTime                   @updatedAt
  member         UserAccount                @relation(fields: [memberId], references: [id], onDelete: Cascade)
  memberId       String
  organization   Organization               @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  organizationId String
  deactivatedAt  DateTime?
  role           OrganizationMembershipRole @default(member)

  @@id([memberId, organizationId])
}

// Test models

/// A mock session table used exclusively for E2E testing.
/// This enables passing access tokens between MSW and the main application,
/// as Playwright's utilities cannot programmatically set access tokens directly
// for user login.
model MockAccessTokenSession {
  /// The access token used as the unique identifier for this mock session
  accessToken String @id
  /// The full mock session data stored as JSON, representing a Supabase session
  sessionData Json
}
